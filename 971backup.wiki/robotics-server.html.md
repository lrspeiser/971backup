 <div class="content">
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even"><p>The team server was migrated to a professional datacenter, stood up, configured, and managed by Stephan Massalt on March 30, 2020.  Thank you to <a href="https://www.plugandplaytechcenter.com/about/">Plug and Play</a> for providing server rack space for the Spartan Robotics team's server needs and <a href="https://outpost.swisscom.com/silicon-valley/">Swisscom</a> for generously donating the hardware to the team.   The datacenter is well documented in the <a href="https://docs.google.com/document/d/1xuihglJQRHbrdM7duSGBOFJ9fxmv1IaW2FT_xslIblI/edit#heading=h.puyetgyfj8ce">971 Datacenter design</a> document.  Contact Stephan for access to this document.  The documentation below describes how things were configured on the old server and are included here as a reference on how things were done in the past.  The new datacenter has carried much of what was created below forward and implemented it on different computers and virtual machines to increase reliability and robustness.</p><p>Until the summer of 2020, the team servers resided on the school ground thanks to Jack Chen in the school's IT department.  Jack was great to work with and very supportive of the team.  After Jack retired, we were told that we needed to move the server off of the school grounds.  Fortunately Stephan had started standing up the datacenter a few months before we were told that we had to leave and we were able to migrate the server services to the datacenter during the middle of the Covid-19 pandemic.  The team, Michael and Wyn in particular, are greatly appreciative of all that Jack did to support the robotics team and wish that all teams enjoyed the awesome support that Jack provided.</p><p>Until July of 2020, the team's server needs were met by using an old HP xw4600 running 64-bit Debian Jessie.  The machine hardware was named FRC 2011-6.  It was put into service in December 2016.  There are notes for how that machine was built and configured in Michael's document files.</p><p>We use to use a "CompuLab fit-PC2 Value (Rev 1.4), Atom Z510 1.1 GHz, RAM 1 GB, bay for 2.5" SATA HDD" that we paid <span style="line-height: 1.538em;">$275.00 to purchase from Amazon.com.  Fit-PC website <a href="http://www.fit-pc.com/wiki/index.php/Fit-PC2_Revisions">revisions page</a>, <a href="http://www.fit-pc.com/wiki/index.php/Fit-PC2_BIOS_ROM_Files">BIOS ROM files</a>, <a href="http://www.fit-pc.com/wiki/index.php/Main_Page">support page</a>, and <a href="http://compulab.co.il/wp-content/uploads/2011/08/SBC-FITPC2-Reference-Guide.pdf">reference guide</a>.  There is also a copy of the reference guide on the team Goolge Docs site under Tools and Machines.  It is running Debian Wheezy and was stood up on January 3, 2014, the day before the FRC season kickoff.  It was replaced late December 2016.</span></p><p>The prior machine was a <a href="http://www.plugcomputer.org/development-kits/guruplug-server-plus.html">GuruPlug Server Plus</a> plug computer purchased from <a href="http://www.globalscaletechnologies.com/t-guruplugdetails.aspx">GlobalScale Technologies</a>.  It has a USB hard disk attached to it.  It is running Debian Lenny and needs to be updated to Squeeze.</p><h2>Disk Configuration</h2><p>The following directories in / are used by SVN, the Apache web server, and for backups.</p><ul><li><strong>svn-repos:</strong> svn repositories</li><li><strong>backups</strong>: Backups made to this machine from this machine and remote machines by commands like tar and cpio.  This the primary version (source location) of these backups.  They can and should be duplicated to other machines using commands like rsync.  A prime candidate is helium at the Schuh home.</li><li><strong>backupsSecondary</strong>:  We use this to make off site backups of backup archives like the ones we keep on helium and iron at the Schuh home.  Be sure and put them in subdirectories based on the machine name.</li><li><strong>backupsNoBackup:</strong> Used to put files on that are not to be backed up to any other machine.  They can be deleted but are being kept around just in case something goes wrong and they save the day.  For example, old versions of svn backups.</li><li><strong>/www:</strong> All web pages accessed from http://robotics.mvla.net/{files,tmp} are in /www/http and all web pages accessed from https://robotics.mvla.net/{files,tmp} are in /www/https.  Within these, we put season specific files in directories like http://robotics.mvla.net/files/2012/images and  http://robotics.mvla.net/files/2012/videos.<ul><li>The /etc/apache2/sites-available/robotics is used to control permissions https pages.  Restart with <strong><em>/etc/init.d/apache2 restart</em></strong>.</li><li>To facilitate people adding files to the http and https websites, we created symbolic links from the user's home directory to the appropriate directories.  i.e. for Jerry<br />   ls -l ~jerry<br />   lrwxrwxrwx 1 root  root    27 2012-02-23 21:14 https_files -&gt; /www/https/files/2012/jerry<br />   lrwxrwxrwx 1 root  root    26 2012-02-23 21:27 www -&gt; /www/http/files/2012/jerry<br />This way, jerry, dave, parker, austin, and michael can quickly add files to the http and https parts of the website.  These users can also go to /www/http and /www/https and add files as needed because they are all in the<strong><em> webfiles</em></strong> group.  Michael and Dave</li></ul></li></ul><h4>Disk Mounts</h4><p>The external hard disk is mounted on /media/usb0.  To avoid having configuration files and symbolic links pointing /media/usb0 they are remounted to directories in /.  The subversion repository and scripts are mounted from the external hard disk on /medial/usb0 and this is remounted with the mount bind option to put the repository in /var/svn-repos.  Similarly, backups, backupsSecondary, backupsNoBackup, and www are remounted in /.</p><p style="padding-left: 30px;"><span style="color: #ff0000;">robotics:/media/usb0/svn-repos# df -h<br /></span></p><p style="padding-left: 30px;">Filesystem            Size  Used Avail Use% Mounted on<br />tmpfs                 251M     0  251M   0% /lib/init/rw<br />udev                   10M  744K  9.3M   8% /dev<br />tmpfs                 251M  4.0K  251M   1% /dev/shm<br />rootfs                463M  380M   84M  82% /<br />tmpfs                 251M   21M  231M   9% /var/cache/apt<br />/dev/sdc1             147G   36G  104G  26% /media/usb0</p><div><span style="color: #ff0000;">robotics:/media/usb0/svn-repos# mount</span><br />tmpfs on /lib/init/rw type tmpfs (rw,nosuid,mode=0755)<br />proc on /proc type proc (rw,noexec,nosuid,nodev)<br />sysfs on /sys type sysfs (rw,noexec,nosuid,nodev)<br />udev on /dev type tmpfs (rw,mode=0755)<br />tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev)<br />devpts on /dev/pts type devpts (rw,noexec,nosuid,gid=5,mode=620)<br />rootfs on / type rootfs (rw)<br />tmpfs on /var/cache/apt type tmpfs (rw,noexec,nosuid)<br />/dev/sdc1 on /media/usb0 type ext3 (rw)<br />/media/usb0/backups on /backups type none (rw,bind)<br />/media/usb0/backupsSecondary on /backupsSecondary type none (rw,bind)<br />/media/usb0/svn-repos on /var/svn-repos type none (rw,bind)<br />/media/usb0/backupsNoBackup on /backupsNoBackup type none (rw,bind)<br />/media/usb0/www on /www type none (rw,bind)</div><div><strong>swap file -</strong> added Sept 4, 2016 after server ran out of memory and killed mysql and brought down frc971.org.</div><div style="padding-left: 30px;">Followed <a href="http://www.cyberciti.biz/faq/linux-add-a-swap-file-howto/">directions at this website</a>.  In short, I did:</div><div style="padding-left: 30px;"><span style="font-size: 13.008px; line-height: 1.538em;">dd if=/dev/zero of=/swapfile1 bs=1024 count=524288</span></div><div style="padding-left: 30px;"><div><div>chmod 0600 /swapfile1</div></div><div><div>mkswap /swapfile1</div><div>swapon /swapfile1</div><div>Add the following to /etc/fstab</div><div><div>/swapfile1 none swap sw 0 0</div></div></div></div><h2>Unattended Upgrades</h2><p>Used to keep the package list and packages upgraded all of time.</p><p>apt-get install unattended-upgrades</p><h2>SVN</h2><p>The /var/svn-repos/authz file is used to control access to the repository.  Look in the /var/log/apache2 directory for helpful log messages.  Use the following command to add a password<br />      htpasswd -s /etc/apache2/dav_svn.passwd   username</p><h2>Gerrit</h2><p>Aug 2, 2014 Brian proposed using Gerrit for managing the team's GIT repository and code reviews.  Michael and Brian decided to install the software and see if we could get it all working.  <a href="https://gerrit-documentation.storage.googleapis.com/Documentation/2.9/index.html">Gerrit documentation</a>.  This is what we did.</p><ul><li>We used the <a href="https://github.com/dnaeon/gerrit-debian">Gerrit for Debian GNU/Linux</a> package builder to make a debian package that correctly locates Gerrit.<ul><li>mkdir /seagate/tmp/gerrit_debian_package</li><li>cd !$</li><li>git clone https://github.com/dnaeon/gerrit-debian.git # made a copy of package sources</li><li>apt-get update</li><li>apt-get upgrade</li><li>apt-get install  build-essential git-core openjdk-7-jre-headless debhelper</li><li>cd /seagate/tmp/gerrit_debian_package/gerrit-debian</li><li>Fetched the most recent version of the gerrit.war file (this is a Java web server archive or something like that) from <a href="http://gerrit-releases.storage.googleapis.com/index.html">Gerrit Code Review - Releases</a>.  We downloaded Gerrit 2.9 with: cd /seagate/tmp/gerrit_debian_package/gerrit-debian/src ; wget -O gerrit.war http://gerrit-releases.storage.googleapis.com/gerrit-2.9.war</li><li>Update the version numbers in debian/changelog by duplicating the first stanza and putting it at the top and changing the version number to 2.9 (the same as the download) and updating the author's name on line 5.</li><li>Update the java version number to be openjdk-7-jre-headless in debian/control</li><li>Build the package with: </li><li>dpkg-buildpackage -us -uc  # this makes a set of install files in /seagate/tmp/gerrit_debian_package<ul><li>-rw-r--r-- 1 root root  41365624 Aug  2 19:07 gerrit_2.9_all.deb</li><li>-rw-r--r-- 1 root root       590 Aug  2 19:06 gerrit_2.9.dsc</li><li>-rw-r--r-- 1 root root      1199 Aug  2 19:07 gerrit_2.9_i386.changes</li><li>-rw-r--r-- 1 root root 167028008 Aug  2 19:06 gerrit_2.9.tar.gz</li></ul></li><li>cd .. ; dpkg -i gerrit_2.9_all.deb  # this creates a series of questions.  <a href="gerrit-code-review-install-questions-and-answers.html">We used most of the defaults and set a few custom values</a>.  The install hung on starting gerrit.  We had to kill off processes 8846 and 8797 to get the install to finish.  dpkg -l showed gerrit 2.9 as installed.<ul><li>gerrit    8797  8794  2 19:15 ?        00:00:17 /usr/bin/java -jar /usr/share/gerrit/gerrit.war init -d /var/lib/gerrit/review_site</li><li>gerrit    8846     1 12 19:19 ?        00:00:43 GerritCodeReview -jar /var/lib/gerrit/review_site/bin/gerrit.war daemon -d /var/lib/gerrit/review_site --run-id=1407032397.8820</li></ul></li><li>We will have to set up apache to properly deal with gerrit so that we can make more progress.</li></ul></li></ul><h5>Web Configuration for Gerrit</h5><ul><li>cd /etc/apache2/</li><li>a2enmod proxy_http # enables http proxy module</li><li><span id="docs-internal-guid-abbaf361-ae55-e272-0178-0518b39681f9">AllowEncodedSlashes On</span></li><li><span id="docs-internal-guid-abbaf361-ae55-e272-0178-0518b39681f9">ProxyPass /gerrit/ http://127.0.0.1:8081/gerrit/ nocanon<br /><a href="http://gerrit-review.googlesource.com/Documentation/config-reverseproxy.html">http://gerrit-review.googlesource.com/Documentation/config-reverseproxy.html<br /></a></span> ProxyRequests Off<br />ProxyVia Off<br />ProxyPreserveHost On</li><li>service apache2 restart  # Restart the server and it worked fine.  </li><li>Access gerrit by going to <a href="https://robotics.mvla.net/gerrit">https://robotics.mvla.net/gerrit</a></li><li>Brian added some lines to the end of /var/lib/gerrit/review_site/etc/gerrit.config and restarted it.<br />21a22,32<br />&gt; [download]<br />&gt;       scheme = ssh<br />&gt;       archive = tbz2<br />&gt;       archive = tgz<br />&gt; [gc]<br />&gt;       startTime = 4:00<br />&gt;       interval = 1 week<br />&gt; [plugins]<br />&gt;       allowRemoteAdmin = true<br />&gt; [suggest]<br />&gt;       from = 1</li></ul><h5>Starting and stopping Gerrit</h5><ul><li>We tried using "/etc/init.d/gerrit restart" to restart gerrit and it "failed".  We found that running it twice worked.</li><li>Restarting with "/etc/init.d/gerrit stop" followed by "/etc/init.d/gerrit start" worked.</li></ul><h5>More Gerrit setup and configuration</h5><ul><li><span style="color: #222222; font-family: arial, sans-serif; line-height: normal;">One thing that I think would be good for somebody else to do is to write a program to handle automatically ensuring every commit builds and the tests pass. It's not hard, but it is a bit of code to write. I think Python is the best language to use for it, but pretty much any will work. The basic idea is to use </span><a style="color: #1155cc; font-family: arial, sans-serif; line-height: normal;" href="http://gerrit-review.googlesource.com/Documentation/cmd-stream-events.html" target="_blank" rel="noopener">gerrit stream-events</a><span style="color: #222222; font-family: arial, sans-serif; line-height: normal;"> to watch for new patch sets being added and then use </span><a style="color: #1155cc; font-family: arial, sans-serif; line-height: normal;" href="http://gerrit-review.googlesource.com/Documentation/cmd-review.html" target="_blank" rel="noopener">gerrit review</a><span style="color: #222222; font-family: arial, sans-serif; line-height: normal;"> to approve it or not and send a link to the results. If anybody is interested in working on that, I'd be happy to help.  (From Aug 6, 2014 email to Daniel from Brian)</span></li></ul><h2>GIT</h2><p>To set up a git user, first set up an svn account.</p><ul><li><span style="line-height: 1.538em;">vi /var/svn-repos/authz    # put in an entry listing who the person is and add them to the 971 group.</span></li><li><span style="line-height: 1.538em;">htpasswd -s /etc/apache2/dav_svn.passwd javier</span></li></ul><p><span style="line-height: 1.538em;">Make a regular user account on robotics.mvla.net.  Ask the user to use a strong password.</span></p><ul><li><span style="line-height: 1.538em;">adduser javier # adduser asks for the password first and then the user information (name etc).</span></li></ul><p><span style="line-height: 1.538em;">Put the new git user in the webfiles group with the others.</span></p><ul><li><span style="line-height: 1.538em;">vi /etc/group</span></li></ul><p><span style="line-height: 1.538em;">Wrote /etc/apache2/make_git.passwd to create /etc/apache2/git{114,971}.passwd files using the team groups</span><span style="line-height: 1.538em;"> in /var/svn-repos/authz and the passwords from /etc/apache2/dav_svn.passwd.</span></p><ul><li><span style="line-height: 1.538em;">/etc/apache2/make_git.passwd   # Run this so that git web works for the new user.</span></li></ul><p>Quick usage guide for how to use git to track local files.  Hopefully, Michael can use these to replace rcs usage.  At least, that is Austin's hope.  Dec 25, 2015</p><p># Create a repostory.  First cd into the dirctory that has the files to be revisioned.</p><p>cd /tmp<br /><span style="font-size: 13.008px; line-height: 1.538em;">mkdir etc_test<br />cd etc_test<br />cp /etc/hosts . </span></p><p># Create a repository<br /><span style="font-size: 13.008px; line-height: 1.538em;">git init</span></p><p># Add a  file<br /><span style="font-size: 13.008px; line-height: 1.538em;">git add hosts</span></p><p><span style="font-size: 13.008px; line-height: 1.538em;"># Check the status<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">git status</span></p><p># Commit the file<br /><span style="font-size: 13.008px; line-height: 1.538em;">git commit<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">git commit -m "Added Google hostname." hosts</span></p><p># Show the versions with <br />git log</p><p>michael@radon:/tmp/git_work$ git log</p><p>commit 1ec6ff291297bfc2192cb1e4c4e121214c491619<br /><span style="font-size: 13.008px; line-height: 1.538em;">Author: Michael Schuh &lt;michael@xx.com&gt;<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">Date:   Fri Dec 25 11:49:44 2015 -0800</span></p><p>    Added Google hostname.</p><p>commit 009f1f0fb3200dc812ae5feb5d19cec859a5cf91<br /><span style="font-size: 13.008px; line-height: 1.538em;">Author: Michael Schuh &lt;michael@xx.com&gt;<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">Date:   Fri Dec 25 11:38:06 2015 -0800</span></p><p>    Small change.</p><p>commit c115f9b887782170dcec3c20d4ecfc4877838f2b<br /><span style="font-size: 13.008px; line-height: 1.538em;">Author: Michael Schuh &lt;michael@xx&gt;<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">Date:   Fri Dec 25 11:33:53 2015 -0800</span></p><p>    First version.</p><p># Show recent activity with the commit actions with more detail by using the "reflog" command<br />git reflog <br /><span style="font-size: 13.008px; line-height: 1.538em;">009f1f0 HEAD@{0}: commit: Small change.<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">c115f9b HEAD@{1}: commit (amend): First version.<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">8c2d84d HEAD@{2}: commit (initial): First version.</span></p><div><span style="font-size: 13.008px; line-height: 1.538em;"># Compare with a particular commit with a uniq fraction of the number.<br /> </span>git diff 009f</div><div># or with</div><div> git diff 009f1f0fb3200dc812ae5feb5d19cec859a5cf91</div><p># "master" is the term git users us for the equivalent of the svn "head".  It is the "branch" that everyone works on.</p><h2>Gitiles</h2><p>Gitiles is used to better view the team source code.</p><p>Clone the repository with</p><p>cd ~michael/src (I did this logged in as user michael)<br />git clone https://gerrit.googlesource.com/gitiles<br />cd gitiles<br />git checkout v0.2-5<br /># Use the build stand alone directions in https://gerrit.googlesource.com/plugins/gitiles/+/master/src/main/resources/+Documentation/build.md#Build-in-Gerrit-tree<br /><span style="font-size: 13.008px;"># Copy 971-Robot-Code/tools/bazel ~/src/gitiles/tools<br />bazel build :gitiles  (This should build the code.)<br /># To install, follow the direction in </span>https://gerrit-review.googlesource.com/Documentation/cmd-plugin-install.html<br /># we had Parker run this command <br /><span style="font-size: 13.008px;">ssh -p 29418 localhost gerrit plugin install -n gitiles.war /home/michael/src/gitiles/bazel-bin/gitiles.war<br />This did not work either.  Brian said we have to build it in the gerrit software.  He said to use gerrit tag version 2.13.4.</span></p><p>Install the plugin following the directions at https://gerrit-review.googlesource.com/Documentation/cmd-plugin-install.html</p><p> </p><h2>Mail/qmail</h2><p>On May 12, 2014, Austin installed qmail.  To make it work, he had to edit /etc/hosts and make sure that the 192.168.10.61 line had robotics.mvla.net as the first entry so that hostname -f would return the full host name.  He<span style="line-height: 1.538em;"> then installed qmail and qmail-run.</span></p><p style="padding-left: 30px;">apt-get install qmail qmail-run</p><p style="padding-left: 30px;">When he did this, apt-get install complained about the installed email package and asked that it be removed.  He probably removed it with "dpkg -r packageName".</p><p style="padding-left: 30px;">He said that after that, everything just worked.</p><p>On May 12, 2014, Austin tried to get email working on robotics.mvla.net and left the root email configured in a way that email to root did not work.  Michael &amp; Brian debugged this Aug 2, 2014.</p><ul><li>Updated the root: entry in /etc/aliases to michael and forces the aliases file to be reloaded by running "newaliases".</li><li>Removed the /var/lib/qmail/.qmail-root file.  It pointed to "&amp;alias" which did not exist.</li><li>Noticed that .qmail-postmaster pointed to "&amp;alias" and this failed due to no "alias" user.  We fixed this by adding .qmail-alias file and putting "&amp;root" in it.  qmail was restarted with the "qmailctl restart" command.</li><li>Added ~michael/.qmailrc with "|forward michael at boardsailor.com"</li><li>Now root, postmaster, and a bunch of other emails all go to Michael's Gmail account.</li></ul><p>On Aug 3, 2014, Michael figured out that email to frc971.org was not being delivered.  Having fixed email to root the day before with Brian, Michael found error messages in his email saying email was bouncing.  The main complaint was that site at SpartanRobotics.org did not exist.  Because of this he was not receiving messages saying that there was out of date server software.  He also figured out that email sent from the team website contact page was not going through.  He fixed this by reading the <a href="http://www.lifewithqmail.org/lwq.html#multiple-hostnames">Multiple host names</a> section in the <a href="http://www.lifewithqmail.org/lwq.html">qmail man pages</a> and then:</p><ul><li>cd /var/lib/qmail/control (this is linked to /etc/qmail on our machine.</li><li>added frc971.org and spartanrobotics.schuhusa.org, and spartanrobotics.org on separate lines to both the locals and rcpthosts files.  They both contain:<br /><span style="line-height: 1.538em;">robotics.mvla.net<br /></span><span style="line-height: 1.538em;">frc971.org<br /></span><span style="line-height: 1.538em;">spartanrobotics.schuhusa.org<br /><span style="line-height: 1.538em;">spartanrobotics.org</span></span></li><li><span style="line-height: 1.538em;">Restarted qmail with: </span><span style="line-height: 1.538em;">qmailctl reload</span></li><li>Added an alias so that email to site goes to Michael by adding the line "site: michael" to the bottom of the /etc/aliases file.</li><li>Made the mail system reread and use the updated /etc/aliases file by running "newaliases".  See the newaliases man page (man 1 newaliases) for more information on it.</li></ul><p>On July 25, 2015, I added losaltosrobotics.org using the same procedure Brian and I used to add other names on August 3, 2014.</p><h2>Backup Strategy</h2><p>Cron jobs run by root backup the svn repository to /backups/svn/robotics.mvla.net.daily using the scripts in /seagate/svn-local-bin.</p><p style="padding-left: 30px;">-rwxr-xr-x 1 root root 4480 2011-12-26 18:18 backupOnlyChangedArchives.csh<br />-rwxr-xr-x 1 root root 4725 2011-12-26 21:05 backupOnlyChangedArchivesDaily.csh<br />-rwxr-xr-x 1 root root 4185 2011-12-26 21:06 backupOnlyChangedArchivesWeekly.csh</p><p>Use the backupScripts.csh in /seagate/svn-local-bin to backup the scripts, notes, and configuration files to /backups/linux/robotics.mvla.net/ with names like 20111203.2206_subversion_notesAndConfig.tgz.  The backupScripts.csh script should be run by hand after changes to these files.</p><p>OS backups are created by a cron job that runs the  $HOME/bin/backupSchuhComputers.rb script with -0, -1, and -2 flags for full backup, weekly, and daily backups.  The backup files are saved in /backups/linux/robotics.mvla.net.  They are copied daily to helium by a cron job run from helium at Michael's home.  The /etc/backupSchuhComputers.exclude </p><ul><li><span style="font-size: 13.0080003738403px; line-height: 1.538em;">var/svn-repos</span></li><li><span style="font-size: 13.0080003738403px; line-height: 1.538em;">var/svn-repos.firstTry</span></li><li><span style="font-size: 13.0080003738403px; line-height: 1.538em;">usr/local/Plone-4.3.3</span></li><li><span style="font-size: 13.0080003738403px; line-height: 1.538em;">usr/local/Plone-4.3.3-UnifiedInstaller</span></li><li><span style="font-size: 13.0080003738403px; line-height: 1.538em;">var/log/auth.log  # Added because it would change as it was being backed up and cause the backup to fail.</span></li></ul><p>The LosAltosRobotics.org website is restored by following the directions in /usr/local/Plone_notes.txt.  After reinstalling Plone from the <a href="https://plone.org/products/plone">Plone download page</a>, be sure and add in all of the security patches listed on the <a href="https://plone.org/security/hotfixes/">Plone HotFixes page</a>.</p><p>The FRC971.org Plone and robotics.mvla.net websites are restored as part of the linix OS backups.  The FRC971.org Plone database is also backed up seperately.</p><p>The /var/svn-repos directory is restored by pulling the var/svn-repos directory out of the 20111203.2206_subversion_notesAndConfig.tgz backup file generated by the backupScripts.csh script in /seagate/svn-local-bin directory.  The repositories are backed up in helium:/backups/SpartanRobotics/rsync/backups/svn/robotics.mvla.net.daily</p><p> time tar -xzf /tmp/frc971-7770.tar.gz  # Commands to restore a repository from the tar and dump backups.<br /><span style="font-size: 13.008px; line-height: 1.538em;"> svnadmin load frc971-7770 &lt; /tmp/frc971_7771-7868.WeeklyIncr.dump<br /></span><span style="font-size: 13.008px; line-height: 1.538em;"> svnadmin load frc971-7770 &lt; /tmp/frc971_7869-7873.DailyIncr.dump<br /></span><span style="font-size: 13.008px; line-height: 1.538em;"> svnadmin load frc971-7770 &lt; /tmp/frc971_7874-7874.DailyIncr.dump<br /></span><span style="font-size: 13.008px; line-height: 1.538em;"> svnadmin load frc971-7770 &lt; /tmp/frc971_7875-7883.DailyIncr.dump<br /></span><span style="font-size: 13.008px; line-height: 1.538em;"> svnadmin load frc971-7770 &lt;  /tmp/frc971_7884-7887.DailyIncr.dump<br /> mv  </span> frc971-7770 frc971<br /><span style="font-size: 13.008px; line-height: 1.538em;"> chown -R www-data.subversion frc971</span></p><p>The external Seagate hard disk has the following contents:</p><p>drwxr-xr-x 5 root root  4096 Dec 31  2011 backups<br /><span style="font-size: 13.008px; line-height: 1.538em;">drwxr-xr-x 2 root root  4096 Apr 14  2015 backupsNoBackup<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">drwxr-xr-x 2 root root  4096 Oct  7  2011 backupsSecondary<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">drwxr-xr-x 2 root root  4096 Dec 26 14:46 RCS<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">-rw-r--r-- 1 root root  1601 Dec 26 14:45 README.txt<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">drwxr-xr-x 3 root root  4096 Dec 26 14:48 svn-local-bin<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">drwxr-xr-x 4 root root  4096 Oct  6 20:58 tmp<br /></span><span style="font-size: 13.008px; line-height: 1.538em;">drwxr-xr-x 4 root root  4096 Feb 23  2012 www</span></p><div>The RCS and README.txt files and svn-local-bin directory are backed up in the 20111203.2206_subversion_notesAndConfig.tgz backup file generated by the backupScripts.csh script in /seagate/svn-local-bin directory.  The backups and www directories are rsync'ed to helium nightly and the others are not backed up.  The README.txt describes their contents.</div><p>Cron jobs on helium (plug computer located at the Schuh home) run under the michael user to backup the /backups/ directory to helium:/backups/SpartanRobotics/backups_from_robotics.mvla.net_via_rsync .</p><p style="padding-left: 30px;"># min hour dayOfMonth month dayOfWeek command<br />#<br /># ===========<br /># =========== Backup robotics.mvla.net:/backups<br /># ===========     Run it at 4 am.<br />    0      4     *          *         *       (echo -e "\n============ "; date ; rsync -av  --log-file=$HOME/log/rsync_robotics.log   michael@robotics.mvla.net:/backups /backups/SpartanRobotics/backups_from_robotics.mvla.net_via_rsync ) &gt;&gt; $HOME/log/rsync_stdo_robotics_backups.log 2&gt;&amp;1<br /># ===========<br /># =========== Backup robotics.mvla.net:/var/www<br /># ===========     Run it at 3:50 am.<br />    43      20     *          *         *       (echo -e "\n============ "; date ; rsync -av  --log-file=$HOME/log/rsync_robotics.log   michael@robotics.mvla.net:/var/www /backups/SpartanRobotics/backups_from_robotics.mvla.net_via_rsync ) &gt;&gt; $HOME/log/rsync_stdo_robotics_www.log 2&gt;&amp;1</p><h2>Security</h2><p>2015-07-05  Brian told me about the <strong>fail2ban</strong> package that locks out attackers that cause too many log messages.  I installed it and it immediately disabled an IP address. apt-get install ntp</p><h2>Basic Configuration</h2><p>2015-05-27 I installed the <strong>NTP daemon</strong> to <strong>keep the time correctly</strong> at Brian's suggestion.  apt-get install ntp</p><h2>Spartan Robotics Drupal Website:</h2><p>2014-05-01 I created some <a href="https://docs.google.com/document/d/1h9JzQOZFfIUrRD7NNLJF6jaNPpZaXtPhteWrheCaTyE/edit">detailed installation notes</a> when I moved the SpartanRobotics.org website from Bruce Moxin's server to robotics.mval.net</p><h2>Apache</h2><p>Apache <a href="http://httpd.apache.org/docs/">documentation</a>.  We are running Apache <a href="http://httpd.apache.org/docs/2.2/">version 2.2</a> on robotics.mvla.net.</p><ul><li>Directives in the <a href="http://httpd.apache.org/docs/2.2/configuring.html">Configuration files</a> <span style="line-height: 1.538em;">may apply to the entire server, or they may be restricted to apply only to particular directories, files, hosts, or URLs. <a href="http://httpd.apache.org/docs/2.2/sections.html">This document</a> describes how to use configuration section containers or .htaccess files to change the scope of other configuration directives.</span></li><li>Index to <a href="http://httpd.apache.org/docs/2.2/mod/directives.html">directives</a>.</li><li>I use the server to host the Los Altos Robotics website.  Here are my <a href="los-altos-robotics-plone-server.html">notes for how I set up Apache to point to the Plone server</a>.</li><li>On October 12, 2014, Douglas and Michael had trouble downloading a robot log file that had been compressed.  The file had a ".txt.gz" extension on it.  We figured out that it was being compressed by Apache and not decompressed by the browser.  This double compression resulted in the file appearing to be a mess.  This <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=610679">bug report talks about it</a> and this <a href="http://stackoverflow.com/questions/11440448/how-to-exclude-urls-from-apache-mod-deflate-via-setenvifnocase">How to exclude urls from Apache mod_deflate via SetEnvIfNoCase</a> post offers a solution.  It looks like Apache is seeing the ".txt" part of the extension and compressing the file as if it is a text file and that Apache is ignoring the ".gz" part.  We were able to download files with out the ".txt" ending in ".gz" and have them be the same on our client as they were on the server.  The compression is handled by <a href="http://httpd.apache.org/docs/2.2/mod/mod_deflate.html">mod_deflate</a>.  The <a href="http://httpd.apache.org/docs/2.4/mod/mod_deflate.html">Apache version 2.2 mod_deflate manual</a> has some different and informative examples in it so it might be worth checking out too.  Below is the mod_deflate configuration file that worked.  I restarted the server with "<span style="line-height: 1.538em;">service apache2 reload".  Brian helped out by writing the "no-gzip" line and locating the solution post.  Michael suspects that the "MIME-TYPE" for text files is poorly written and does not see the ".gz" closing enxtension.  It might work fine if a "$" is added to it.  Michael Oct 13, 2014</span><pre> &lt;IfModule mod_deflate.c&gt;
# these are known to be safe with MSIE 6
AddOutputFilterByType DEFLATE text/html text/plain text/xml

# everything else may cause problems with MSIE 6
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE application/x-javascript application/javascript application/ecmascript
AddOutputFilterByType DEFLATE application/rss+xml

# Brian suggested adding this line so that already compressed files are not compressed a second time.
# I took the answer from
# http://stackoverflow.com/questions/11440448/how-to-exclude-urls-from-apache-mod-deflate-via-setenvifnocase
# and tweaked it.
# I read the mod_deflate man page http://httpd.apache.org/docs/2.2/mod/mod_deflate.html
# and it had some good information in it too.
# Oct 13, 2014. Michael
SetEnvIfNoCase Request_URI \.(?:gz|bz2|xz)$ no-gzip
&lt;/IfModule&gt;
</pre></li></ul><h2>Network Configuration:</h2><p>The machine has one network interface.  The eth0 network is connected to the school network with 172.20.252.61 default route 172.20.252.254 and netmask of 255.255.0.0.  External to the school, the name is robotics.mvla.net with address: 205.167.46.61.  The server was moved to the 172.20.252.61 address on Feb 7, 2014 by Michael and Jack.  Jack set it up so we can ping the machine, send email to it, ssh to it, and use http and https.  Jack said that ports 1-32 are for the student network, 33-38 are for the teacher network, and 39-48 are for the wireless.</p><pre style="padding-left: 30px;">root@robotics:~# ifconfig
eth0 Link encap:Ethernet HWaddr 00:01:c0:08:b2:95
inet addr:172.20.252.61 Bcast:172.20.255.255 Mask:255.255.0.0
inet6 addr: fe80::201:c0ff:fe08:b295/64 Scope:Link
UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1
RX packets:329739 errors:0 dropped:1 overruns:0 frame:0
TX packets:128574 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:1000
RX bytes:33126632 (31.5 MiB) TX bytes:134835716 (128.5 MiB)
Interrupt:40 </pre><pre style="padding-left: 30px;"> </pre><pre style="padding-left: 30px;">root@robotics:~# ip route
default via 172.20.252.254 dev eth0
172.20.0.0/16 dev eth0 proto kernel scope link src 172.20.252.61
</pre><pre style="padding-left: 30px;"> </pre><pre style="padding-left: 30px;">root@robotics:~# route
Kernel IP routing table
Destination Gateway Genmask Flags Metric Ref Use Iface
default 172.20.252.254 0.0.0.0 UG 0 0 0 eth0
172.20.0.0 * 255.255.0.0 U 0 0 0 eth0</pre><pre style="padding-left: 30px;"> </pre><pre style="padding-left: 30px;">root@robotics:~# route -n
Kernel IP routing table
Destination Gateway Genmask Flags Metric Ref Use Iface
0.0.0.0 172.20.252.254 0.0.0.0 UG 0 0 0 eth0
172.20.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0
<br />root@robotics:~# cat /etc/network/interfaces
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

# DHCP configuration has these two lines.
#auto eth0
#iface eth0 inet dhcp

# Fixed IP configuration has these lines.
# Enter the nameserve address in /etc/resolv.conf by hand after switching from
# DHCP to manually configured. Use 8.8.4.4 and 8.8.8.8
auto eth0
allow-hotplug eth0
iface eth0 inet static
address 172.20.252.61
netmask 255.255.0.0
network 172.20.252.0
gateway 172.20.252.254
dns-nameservers 8.8.4.4
</pre><h2>Notes from Jan 2014 installation on fit-PC</h2><p><span style="color: #222222; font-family: arial; font-size: small; line-height: normal;">Brian and Michael installed Linux on it.  The first section of these notes covers the Linux installation.  The next section talks about how the machine was configured to work as our robotics.mvla.net SVN server.  Unfortunately, I ran out of energy to document all of the steps required so some of the last steps are not written down.  They involved making links and setting up the backups.  Details on the fit-PC2 hardware are located at the <a href="robotics-server.html">top of this page</a>.  Michael Schuh, Jan 9, 2014.</span></p><div style="color: #222222; font-family: arial; font-size: small; line-height: normal;"><ul><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">Hit F2 while booting to get to the Prom BIOS configuration.  Make sure the internal hard disk boot device is the lowest in the list.</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">Set up a "Flash drive" (USB Thumb drive) following the directions at <a style="color: #1155cc;" href="http://www.debian.org/releases/stable/i386/ch04s03.html.en" target="_blank" rel="noopener">http://www.debian.org/releases/stable/i386/ch04s03.html.en</a> .  Try to find one that does not try to install drivers when inserted into a Windows computer.</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">i386 on CD netinst version.  <a style="color: #1155cc;" href="http://www.debian.org/CD/http-ftp/#stable" target="_blank" rel="noopener">http://www.debian.org/CD/http-ftp/#stable</a></li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">Insert in USB port and connect power.  This should bring up the Install selector and select "Install".</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">Select software sets<ul><li>Web server</li><li>Mail server</li><li>SSH server</li><li>Standard system utilities</li></ul></li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">After booting it, install firmware with dpk</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">dpkg -i firmware-realtek_*<ul><li>get firmware.tar.gz from <a style="color: #1155cc;" href="http://cdimage.debian.org/cdimage/unofficial/non-free/firmware/stable/20131215/" target="_blank" rel="noopener">http://cdimage.debian.org/cdimage/unofficial/non-free/firmware/stable/20131215/</a></li><li>Directions at <a style="color: #1155cc;" href="http://www.debian.org/releases/stable/i386/ch06s04.html.en" target="_blank" rel="noopener">Loading Missing Firmware</a></li><li>Brian put the packages on the machine via "flash drive"</li></ul></li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">dhclient eth0 # Starts up the network by hand</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">apt-get update</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">apt-get install vim</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">vi /etc/apt/sources-list and add "contrib non-free" to each line.</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">apt-get update</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">apt-get install firmware-linux-nonfree rsync xz-utils less</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">shutdown -r now</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">dhclient eth0 # Starts up the network by hand</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">Use "dmesg" to show the kernel log message.</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">apt-get install subversion subversion-tools git rcs vim-gtk</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">vi /etc/network/interfaces and add "\nauto eth0\niface eth0 inet dhcp" to the end of the file.</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">shutdown -r now  # Checking </li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;"><a style="color: #1155cc;" href="https://help.ubuntu.com/community/AutomaticSecurityUpdates" target="_blank" rel="noopener">https://help.ubuntu.com/community/AutomaticSecurityUpdates</a> has information on setting up automatic installation of security patches.</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">apt-get install websvn # reconfigure with "dpkg-reconfigure websvn"</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">copy /etc/{shadow,passwd,group} to the new machine and copy user account entries into it.</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">Use tar to copy accounts in /home to the new machine.</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">Set the date: date 121920462013</li><li style="color: #222222; font-family: arial; font-size: small; line-height: normal;">Copy svn repository backups over and restore them.<ul><li>mkdir /var/svn-repos</li><li>Copy backups to /var/svn-repos/tmp</li><li>On helium in /backups/SpartanRobotics/rsync/backups/svn/robotics.mvla.net.daily run<br />scp -p frc971-training2013-22.tar.bz2 frc971-4622.tar.bz2 frc971_4623-4626.WeeklyIncr.dump 192.168.0.30:/var/svn-repos/tmp</li><li>cd /var/svn-repos</li><li>tar -xvf tmp/frc971-4622.tar.bz2 </li></ul></li><li><span style="color: #222222; font-family: arial; font-size: x-small;"><span style="line-height: normal;">Working on setting up WebSVN - Refer to </span></span><a style="color: #1155cc;" href="http://www.howtoforge.com/debian_subversion_websvn" target="_blank" rel="noopener">http://www.howtoforge.com/debian_subversion_websvn</a><ul style="color: #222222; font-family: arial; font-size: small; line-height: normal;"><li>cd /var/svn-repos</li><li>chown -R www-data.subversion frc971</li></ul></li><li><span style="color: #222222; font-family: arial; font-size: x-small;"><span style="line-height: normal;">Install NPT daemon to keep the time correctly on the machine - Brian suggested this May 13, 2015</span></span><ul><li><span style="color: #222222; font-family: arial; font-size: x-small;"><span style="line-height: normal;">apt-get install ntp</span></span></li></ul></li></ul></div><h3 style="color: #222222; font-family: arial; font-size: small; line-height: normal;">I found my old notes on how I built the helium server at the house.  I followed those directions.  I updated them some, but not completely.  They can be used as a guide if needed.</h3><div><ul><li><span style="font-family: 'Times New Roman'; font-size: medium; line-height: 1.538em;">Looked at differences in the package list and installed</span><ul><li><span style="font-family: 'Times New Roman'; font-size: medium; line-height: 1.538em;">apt-get install rcs ruby csh tcsh ed bzip2 zip ispell  make samba vim unzip subversion samba-doc samba-doc-pdf lynx sudo bind9 g++ gcc libssl-dev build-essential </span></li></ul></li></ul><ul style="font-family: 'Times New Roman'; font-size: medium; line-height: 1.538em;"><li style="margin-left: 15px;"><span style="font-family: 'Times New Roman'; font-size: small;">cd /tmp</span></li><li style="margin-left: 15px;"><span style="font-family: 'Times New Roman'; font-size: small;">ssh robotics dpkg -l &gt; s</span></li><li style="margin-left: 15px;"><span style="font-family: 'Times New Roman'; font-size: small;">dpkg -l &gt; s2</span></li><li style="margin-left: 15px;"><span style="font-family: 'Times New Roman'; font-size: medium;">awk '{print $2}' s &gt; s.1</span></li><li style="margin-left: 15px;"><span style="font-family: 'Times New Roman'; font-size: medium;">517  awk '{print $2}' s2 &gt; s2.1</span></li><li style="font-family: 'Times New Roman'; font-size: medium; margin-left: 15px;">diff s.1 s2.1</li><li style="font-family: 'Times New Roman'; font-size: medium; margin-left: 15px;">apt-get install tcsh sudo ruby irb ed libapache2-svn</li><li style="font-family: 'Times New Roman'; font-size: medium; margin-left: 15px;">Skipped </li></ul><ul><li style="font-family: 'Times New Roman'; font-size: medium; margin-left: 15px;">Copy <a style="color: #1155cc;" href="http://issue.net/" target="_blank" rel="noopener">issue.net</a> file for ssh logins: cd /etc; mkdir RCS; ci -l <a style="color: #1155cc;" href="http://issue.net/" target="_blank" rel="noopener">issue.net</a>; scp helium:/etc/<a style="color: #1155cc;" href="http://issue.net/" target="_blank" rel="noopener">issue.net</a>/etc/<a style="color: #1155cc;" href="http://issue.net/" target="_blank" rel="noopener">issue.net</a></li><li style="margin-left: 15px;">Setting up svn server<ul><li style="margin-left: 15px;"><a style="color: #1155cc;" href="http://blog.mattsch.com/2011/03/21/setting-up-apache-and-subversion-on-debian-squeeze/" target="_blank" rel="noopener">Setting up Apache and Subversion on Debian Squeeze</a> - follow these directions</li><li style="margin-left: 15px;">apt-get install websvn subversion-tools subversion libapache2-svn<br /><ul><li style="margin-left: 15px;">Tell it to use "/var/svn-repos" rather than "/usr/var/svn"</li><li style="margin-left: 15px;">Note on permissions from the installer:                                                                                                                                                 <br />   Due to a limitation in the DB format, the 'svnlook' command needs read-write access to the repository (to create locks etc). You need to give         <br />   read-write permissions to the user running your webserver on all your repositories.                                                                   <br />                                                                                                                                                         <br />   Another way of avoiding this problem is by creating SVN repositories with the --fs-type=fsfs option.  Existing DB repositories can be converted to    <br />   the FSFS format by using the svnadmin dump/load commands.</li></ul></li><li style="margin-left: 15px;">mkdir /var/svn-repos ; scp -rp tin:/opt/subversion/etc /var/svn-repos (copy the repositories over or preferably restore them from backups) ; chown -R www-data.www-data /var/svn-repos/etc</li><li style="margin-left: 15px;">Make sure paths are correct in /etc/websvn.  Look at the old server to see how this is done.  No need to restart apache2 after doing this.<ul><li style="margin-left: 15px;">Run "dpkg-reconfigure websvn" to make sure that the path is set to /var/svn-repos.  I left the "apache, apache-ssl, apache-perl, and apache2" options all checked.  I answered "/var/svn-repos" to both the "location of each parent directory" and "location of each svn repository" questions.  This updates the /etc/websvn/svn_deb_conf.inc file.</li><li style="margin-left: 15px;">Set the path in the config.phg file to "$config-&gt;useAuthenticationFile('/var/svn-repos/authz'); // Global access file"</li><li style="margin-left: 15px;">This page talks about setting up Web_SVN and the /etc/websvn config files.  <a style="color: #1155cc;" href="http://www.howtoforge.com/debian_subversion_websvn" target="_blank" rel="noopener">http://www.howtoforge.com/debian_subversion_websvn</a></li></ul></li><li style="margin-left: 15px;">cd /etc/apache2/mods-available ; mkdir RCS; ci -l dav_svn.conf; Add/uncomment the following lines (or better yet, copy the file from the old server):<br />&lt;Location /svn&gt;<br />   DAV svn<br />   SVNParentPath /var/svn-repos<br />   AuthType Basic<br />   AuthName "Subversion Repository"<br />   AuthUserFile /etc/apache2/dav_svn.passwd<br />   AuthzSVNAccessFile /var/svn-repos/authz<br />   Require valid-user<br />   SSLRequireSSL<br />&lt;/Location&gt;</li><li style="margin-left: 15px;">/etc/apache2 (copy the dav_svn.passwd file from the old server)<br />   dav_svn.passwd - password file.  Use htpasswd to add or change a password<br />                    htpasswd -s /etc/apache2/dav_svn.passwd austin    # Add -c flag to create the file.<br />                    htpasswd -b -s /etc/apache2/dav_svn.passwd austin password # Batch mode with password on the command line.</li><li style="margin-left: 15px;">enable ssl, dav, and dav_svn with<br />#      a2enmod ssl <br />     root@robotics2:/etc/apache2# a2enmod ssl<br />     Enabling module ssl.<br />     See /usr/share/doc/apache2.2-common/README.Debian.gz on how to configure SSL and create self-signed certificates.<br />     To activate the new configuration, you need to run:<br />           service apache2 restart</li><li style="margin-left: 15px;">#      a2enmod dav<br />#      a2enmod dav_svn</li><li style="margin-left: 15px;">Create a /var/svn-repos/authz file (copy from old server) with<br />[etc:/]<br />michael = rw</li><li style="margin-left: 15px;">mkdir /etc/apache2/ssl ; cd /etc/apache2/ssl ; openssl req -new -x509 -days 400 -nodes -out apache.pem -keyout apache.key  # Use Michael.SchuhFamilySSL@Boardsailor.com for email.</li><li style="margin-left: 15px;">Went through directions at <a style="color: #1155cc;" href="http://www.howtoforge.com/debian_subversion_websvn" target="_blank" rel="noopener">http://www.howtoforge.com/debian_subversion_websvn</a><br />  501  cd /etc/apache2/sites-available/<br />  511  scp michael@robotics.mvla.net:/etc/apache2/sites-enabled/robotics schuhSVN <span style="color: #ff0000;">(Copy robotics from old server instead of schuhSVN)</span><br />  513  vi schuhSVN <br /><pre># cat schuhSVN
# Enable this site by running: a2ensite schuhSVN
# and then restart apache2: /etc/init.d/apache2 restart
# Also need to enable ssl, dav, and dav_svn with
# a2enmod ssl
# a2enmod dav
# a2enmod dav_svn
#
# Also see <a style="color: #1155cc;" href="http://blog.mattsch.com/2011/03/21/setting-up-apache-and-subversion-on-debian-squeeze/" target="_blank" rel="noopener">http://blog.mattsch.com/2011/03/21/setting-up-apache-and-subversion-on-debian-squeeze/</a>
# and <a style="color: #1155cc;" href="http://www.howtoforge.com/debian_subversion_websvn" target="_blank" rel="noopener">http://www.howtoforge.com/debian_subversion_websvn</a>


ServerAdmin <a style="color: #1155cc;" href="mailto:webmaster@example.com" target="_blank" rel="noopener">webmaster@example.com</a>
ServerName <a style="color: #1155cc;" href="http://svn.example.com/" target="_blank" rel="noopener">svn.example.com</a>
DocumentRoot /usr/share/websvn/

Options FollowSymLinks
order allow,deny
allow from all
AuthType Basic
AuthName "Subversion Repository"
Require valid-user
AuthUserFile /etc/apache2/dav_svn.passwd

php_flag magic_quotes_gpc Off
php_flag track_vars On


SSLEngine on
SSLCertificateFile /etc/apache2/ssl/apache.pem
SSLCertificateKeyFile /etc/apache2/ssl/apache.key

</pre>  514  cd ..<br />  519  a2ensite schuhSVN <span style="color: #ff0000;"><strong>(a2ensite robotics)<br />         </strong></span><strong style="color: #ff0000;">  </strong><span style="color: #ff0000;"><strong>a2enmod authz_svn</strong></span></li><li style="margin-left: 15px;">520  /etc/init.d/apache2 restart <strong style="color: #ff0000;">(service apache2 restart) is the new way.</strong><br />527  chown www-data.www-data /var/svn-repos//au*</li><li style="margin-left: 15px;">  530  chmod go+r /var/svn-repos//au*  # I bet that this is not needed.<br />  528  l /var/svn-repos/<br />  529  cd /tmp; svn co <a style="color: #1155cc;" href="https://losaltosrobotics/svn/etc" target="_blank" rel="noopener">https://losaltosrobotics/svn/etc</a>   # Use this for testing.<br />  531  svn co <a style="color: #1155cc;" href="https://losaltosrobotics/svn/etc" target="_blank" rel="noopener">https://losaltosrobotics/svn/etc</a><br />Browse to <a style="color: #1155cc;" href="https://robotics.mvla.net/" target="_blank" rel="noopener">https://robotics.mvla.net/</a> or <a style="color: #1155cc;" href="https://192.168.0.10/" target="_blank" rel="noopener">https://192.168.0.10/</a></li><li style="margin-left: 15px;"><span style="color: #ff0000;">svnadmin: Can't open file '/pathtorepo/db/fsfs.conf'</span>: No such file or directory" Error message from svn-hot-backup script<ul><li style="margin-left: 15px;"><a style="color: #1155cc;" href="http://www.tikalk.com/alm/subversion-hot-backup-change-1611" target="_blank" rel="noopener">This page says the problem is that SVN 1.6 changed things</a>.  It suggests doing an "svnadmin upgrade /path/toRepository" and adding the offending file as one option.  The other is to do a dump, create a new repository, and then do an "svn load".  He claimed that this would make the most optimal copy of the repository.  I tried this with etc.  I am not sure it was worth the optimal part of the claim.<br /><ul><li style="margin-left: 15px;">svnadmin dump etc &gt; etc.dump</li><li style="margin-left: 15px;">mv etc etc.old</li><li style="margin-left: 15px;">svnadmin create etc</li><li style="margin-left: 15px;">svnadmin load etc &lt; etc.dump   # This was slow on the plug computer.</li></ul></li></ul></li><li>Make files and git links in /usr/share/websvn</li><li>cd /usr/share/websvn</li><li>ln -s  /www/https/files/ files</li><li>ln -s  /www/https/git git</li></ul></li><li style="margin-left: 15px;">Set up links in /var/www<ul style="color: #222222; font-family: arial; font-size: small; line-height: normal;"><li style="margin-left: 15px;">cd /var/www</li><li style="margin-left: 15px;">ln -s /www/http/files files</li><li style="margin-left: 15px;">ln -s /www/http/tmp tmp</li><li style="margin-left: 15px;">cp (from old machine):/var/www/index.html /var/www/index.html # Has "Hi Travis" in it.</li></ul></li><li style="margin-left: 15px;">Set up links in /root/bin<ul><li style="margin-left: 15px;">root@robotics2:~/bin# l </li><li style="margin-left: 15px;">lrwxrwxrwx 1 root root 55 Jan  1 17:50 backupOnlyChangedArchives.csh -&gt; ../local/etc/bin_robotics/backupOnlyChangedArchives.csh</li><li style="margin-left: 15px;">lrwxrwxrwx 1 root root 60 Jan  1 17:51 backupOnlyChangedArchivesDaily.csh -&gt; ../local/etc/bin_robotics/backupOnlyChangedArchivesDaily.csh</li><li style="margin-left: 15px;">lrwxrwxrwx 1 root root 61 Jan  1 17:51 backupOnlyChangedArchivesWeekly.csh -&gt; ../local/etc/bin_robotics/backupOnlyChangedArchivesWeekly.csh</li><li style="margin-left: 15px;">lrwxrwxrwx 1 root root 36 Jan  1 17:51 backupSchuhComputers.rb -&gt; ../local/etc/backupSchuhComputers.rb</li><li style="margin-left: 15px;">lrwxrwxrwx 1 root root 39 Jan  1 17:51 cronfile.root -&gt; ../local/etc/bin_robotics/cronfile.root</li><li style="margin-left: 15px;">lrwxrwxrwx 1 root root 47 Jan  1 17:52 make_index -&gt; /www/https/files/frc971/2013/michael/make_index</li></ul></li><li style="margin-left: 15px;">Set up disk mounts<ul><li style="margin-left: 15px;">mkdir /seagate /backups /backupsSecondary /backupsNoBackup</li><li style="margin-left: 15px;"><span style="color: #222222; font-family: arial; font-size: x-small;"><span style="line-height: normal;">cat &gt;&gt; /etc/fstab   # The "nofail" makes it so the server boots fine without the external USB disk attached.  Otherwise it hangs.</span></span></li></ul></li></ul><span style="color: #222222; font-family: arial; font-size: small; line-height: normal;">              UUID=9cd8be3e-b2ca-40dc-9336-ed53d7b67547 /seagate         ext3    rw,nofail 0       1<br /></span><span style="color: #222222; font-family: arial; font-size: small; line-height: normal;">              /seagate/backups                      /backups                               none    rw,bind                 0 0<span style="color: #000000; font-family: 'Lucida Grande', 'Lucida Sans Unicode', sans-serif; font-size: 13px; line-height: 1.538em;"> </span><br /></span><span style="color: #222222; font-family: arial; font-size: small; line-height: normal;">              /seagate/backupsSecondary       /backupsSecondary               none    rw,bind                 0 0<br /></span><span style="color: #222222; font-family: arial; font-size: small; line-height: normal;">              /seagate/backupsNoBackup        /backupsNoBackup               none    rw,bind                 0 0<br /></span><span style="line-height: 1.538em; color: #222222; font-family: arial;"><span style="line-height: normal;"><span style="font-size: small;">              </span>/seagate/www                            /www                                    none    rw,bind                 0 0</span></span><ul><li style="margin-left: 15px;">Set up Backups - <br /><ul><li style="margin-left: 15px;">mkdir -p /var/schuh/log /var/schuh/backups<ul><li style="margin-left: 15px;">mkdir -p /var/schuh/log /var/schuh/backups</li><li style="margin-left: 15px;">ln -s /var/svn-repos/backup_robotics.log /var/schuh/log</li><li style="margin-left: 15px;">ln -s /var/svn-repos/svn_cron_backups.log /var/schuh/log</li><li style="margin-left: 15px;">cat "var/svn-repos &gt;&gt; /etc/backupSchuhComputers.exclude</li></ul></li><li style="margin-left: 15px;">ln -s ../schuh /var/log/schuh # I could not figure out what this one was for so I did not do it.  1/1/14.</li><li style="margin-left: 15px;">If needed, compile a version of gnutar that will do the incremental backups and put the tar file in ~root/bin<ul><li style="margin-left: 15px;">1/1/14: The installed version of gnutar is 1.26 so I don't need a new copy.</li><li style="margin-left: 15px;">wget <a style="color: #1155cc;" href="http://ftp.gnu.org/gnu/tar/tar-1.26.tar.bz2" target="_blank" rel="noopener">http://ftp.gnu.org/gnu/tar/tar-1.26.tar.bz2</a></li><li style="margin-left: 15px;">wget <a style="color: #1155cc;" href="http://ftp.gnu.org/gnu/tar/tar-1.26.tar.bz2.sig" target="_blank" rel="noopener">http://ftp.gnu.org/gnu/tar/tar-1.26.tar.bz2.sig</a></li></ul></li></ul></li><li><span style="line-height: 1.538em;">Use cron jobs to backup svn and plone to /backups.  Backup log messages are written to /var/schuh/log.</span><br style="line-height: 1.538em;" /><pre style="line-height: 1.538em;"># List the root cronfile with: crontab -l
# Submit this cronfile with: crontab cronfile.root
#
# ~/bin/cronfile.root
#
# Michael Schuh
# August 14, 2010

SHELL=/bin/bash

# =============== Backup the helium root filesystem
# Make a full backup once a quarter on the last day of the month. Note: only run if tomorrow is the first day of the month.
30 22 * 3,6,9,12 * [ `date -d tomorrow +%d` -eq '01' ] &amp;&amp; $HOME/bin/backupSchuhComputers.rb -0 &gt;&gt; /var/schuh/log/backup_helium.log 2&gt;&amp;1
# Do a weekly backup every Sunday morning at just before midnight
30 22 * * Sun $HOME/bin/backupSchuhComputers.rb -1 &gt;&gt; /var/schuh/log/backup_helium.log 2&gt;&amp;1
# Do a daily backup every day except Sunday just before midnight
30 22 * * 0-6 $HOME/bin/backupSchuhComputers.rb -2 &gt;&gt; /var/schuh/log/backup_helium.log 2&gt;&amp;1


# =============== Backup the Los Altos Robotics Plone site every night. The script makes a copy in with the Plone website instance
# in the /backups/linux/$hostname/plone directory. Logs are in /var/schuh/log
#
# min hour dayOfMonth month dayOfWeek command
#55 18 * * * date &gt;&gt; /tmp/crontab.date
40 13 * * * $HOME/bin/backup_LosAltosRoboticsWebsitePloneDatabase.plone4 &gt;&gt; /var/schuh/log/backup_LosAltosRoboticsWebsitePloneDatabasePlone
4.log 2&gt;&amp;1
40 23 * * * $HOME/bin/backup_LosAltosRoboticsWebsitePloneDatabase.plone4 &gt;&gt; /var/schuh/log/backup_LosAltosRoboticsWebsitePloneDatabasePlone
4.log 2&gt;&amp;1
# Backup the blobstorage files. They are needed in addition to the Data.fs file to recover a plone website.
# Make a full backup once a quarter on the last day of the month. Note: only run if tomorrow is the first day of the month.
55 23 * 3,6,9,12 * [ `date -d tomorrow +%d` -eq '01' ] &amp;&amp; $HOME/bin/backupPloneBlobstorageFiles.rb -0 &gt;&gt; /var/schuh/log/backup_LosAltosRoboticsWeb
sitePloneDatabasePlone4_blobstorage.log 2&gt;&amp;1
# Do a weekly backup every Sunday morning at just before midnight
55 23 * * Sun $HOME/bin/backupPloneBlobstorageFiles.rb -1 &gt;&gt; /var/schuh/log/backup_LosAltosRoboticsWebsitePloneDatabasePlone4_blobstorage.log
2&gt;&amp;1
# Do a daily backup every day except Sunday just before midnight
55 23 * * 0-6 $HOME/bin/backupPloneBlobstorageFiles.rb -2 &gt;&gt; /var/schuh/log/backup_LosAltosRoboticsWebsitePloneDatabasePlone4_blobstorage.log
2&gt;&amp;1


# =============== Backup SVN repositories to /backups on the external disk.
# SVN Backup logs are in /var/schuh/log
# Make a full back of repositories once a quarter on the last day of the month. Only repositories that have been changed are backed up.
31 1 * 3,6,9,12 * [ `date -d tomorrow +%d` -eq '01' ] &amp;&amp; $HOME/bin/backupOnlyChangedArchives.csh &gt;&gt; /var/schuh/log/svn_cron_backups.log 2&gt;&amp;1
# Do a weekly backup every Sunday morning at 4 am
0 4 * * Sun $HOME/bin/backupOnlyChangedArchivesWeekly.csh &gt;&gt; /var/schuh/log/svn_cron_backups.log 2&gt;&amp;1
# Do a daily backup every morning at 4 am
0 4 * * * $HOME/bin/backupOnlyChangedArchivesDaily.csh &gt;&gt; /var/schuh/log/svn_cron_backups.log 2&gt;&amp;1</pre><ul><li style="margin-left: 15px;">Use "michael" account ~michael/bin/cronfile.michael" to backup <br /><ul><li style="margin-left: 15px;">svn from <a style="color: #1155cc;" href="http://robotics.mvla.net/" target="_blank" rel="noopener">robotics.mvla.net</a></li><li style="margin-left: 15px;">plone from <a style="color: #1155cc;" href="http://losaltosrobotics.org/" target="_blank" rel="noopener">losaltosrobotics.org</a></li></ul></li></ul></li><li style="margin-left: 15px;">Set up automounting of backup disk at boot time.<br /><ul><li style="margin-left: 15px;">Added "mount -a " to /etc/rc.local".  This is probably how I should add the plone startup.</li><li style="margin-left: 15px;">Added the line "/dev/sda1 /backups ext3 rw 0 0" to the /etc/fstab file.</li></ul></li><li style="margin-left: 15px;">Copy ssh keys from helium:/etc/ssh to new machine:<br />-rw-------  1 root root    668 Feb  7  2010 ssh_host_dsa_key<br />-rw-r--r--  1 root root    601 Feb  7  2010 ssh_host_dsa_key.pub<br />-rw-------  1 root root   1671 Feb  7  2010 ssh_host_rsa_key<br />-rw-r--r--  1 root root    393 Feb  7  2010 ssh_host_rsa_key.pub</li><li style="margin-left: 15px;">Clean up dpkg package download files from /var/cache/apt with: apt-get clean</li></ul></div><div style="color: #222222; font-family: arial; font-size: small; line-height: normal;">Final steps to do before going live.</div><div style="color: #222222; font-family: arial; font-size: small; line-height: normal;"><ul><li>Take the robotics server off line</li><li>Get a current copy of the repositories, /etc/apache2/dav_svn.passwd, /var/svn-repos/{authz,svn_cron_backups.log,RCS}</li><li>Add /usr/share/websvn to the svn tools backup script. (/media/usb0/svn-local-bin/backupScripts.csh )</li><li>Set up a cron job or some other way of backing up the svn tools and the svn-local-bin directory.</li></ul></div><h2>Notes from Dec 2011 installation:</h2><pre>robotics:/media/usb0/svn-repos# cat ~michael/notes.txt <br />/home/michael/notes.txt<br /> These notes<br /><br />Directories:<br /><br />/etc/apache2/sites-available<br /> robotics - This sets up ssl to use websvn<br /> Enable the robotics site by running:<br /> a2ensite robotics<br /> apache2ctl restart<br /> Another way to restart apache2 is: /etc/init.d/apache2 restart<br /><br />/etc/apache2<br /> dav_svn.passwd - password file. Use htpasswd to add or change a password<br /> htpasswd -s /etc/apache2/dav_svn.passwd austin <br /> htpasswd -b -s /etc/apache2/dav_svn.passwd austin password # Batch mode with password on the command line.<br /><br />/etc/apache2/ssl<br /> has apache.{key,pem} files created with "openssl req -new -x509 -days 400 -nodes -out apache.pem -keyout apache.key"</pre><pre style="padding-left: 30px;">Country Name (2 letter code) [AU]:US
State or Province Name (full name) [Some-State]:California
Locality Name (eg, city) []:Mountain View
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Mountain View High School
Organizational Unit Name (eg, section) []:Spartan Robotics FRC Team 971
Common Name (eg, YOUR name) []:robotics.mvla.net
Email Address []:michael.FRC971svnCertificate@bo.......or.com
</pre><div>     Restart the server with: /etc/init.d/apache2 restart</div><pre>/etc/apache2/mods-available<br /> dav_svn.conf - makes it so that "svn co https://robotics.mvla.net/svn/frc971"<br /> goes to the correct place. Also sets svn up to require a<br /> valid user to access the files.<br /> - The values set in dav_svn.conf are:<br /> DAV svn<br /> SVNParentPath /var/svn-repos<br /> AuthType Basic<br /> AuthName "Subversion Repository"<br /> AuthUserFile /etc/apache2/dav_svn.passwd<br /> AuthzSVNAccessFile /var/svn-repos/authz # This file controls the access to the repository<br /> Require valid-user<br /> SSLRequireSSL<br /><br />/etc/websvn<br /> svn_deb_conf.inc - tells websvn where the repository is. Use <br /> "dpkg-reconfigure websvn" to change things.<br /><br />/var/svn-repos<br /> This is where the repositories live.<br /><br />/var/svn-repos/authz # This file controls the access to the repository<br /> # I figured the path out by reading http://svnbook.red-bean.com/en/1.1/svn-book.html#svn-ch-6-sect-4.4.2<br /> [frc:/2011] # This and the next line allow user "michael" access to the 2011 directory in the "frc" repository.<br /> michael = rw<br /> File permissions matter. This works:<br /> -rwxr-x--- 1 www-data subversion 1250 2011-12-05 08:17 authz<br /><br />/var/log/apache2<br /> Log files.<br /><br /># Also need to enable ssl, dav, and dav_svn with<br /># a2enmod ssl <br /># a2enmod dav<br /># a2enmod dav_svn<br />#<br /># Also see http://blog.mattsch.com/2011/03/21/setting-up-apache-and-subversion-on-debian-squeeze/<br /># and http://www.howtoforge.com/debian_subversion_websvn<br /># in the "howtoforge.com" instructions, skip the enscript part<br /># as it is no longer needed.<br /><br /><br />Installed packages include:<br /> apt-get install subversion-tools<br /><br />Change the system timezone with<br /> dpkg-reconfigure tzdata<br /><br />To update the timezone, use<br /> ntpdate time.nist.gov<br /><br /><br />I think apt-get was pulling packages from the squeeze distribution for a while before Austin changed <br />the sources.list file to point to lenny packages. It appears from the date on the sources.list file<br />this was changed July 2011. Here are some packages that look wrong.<br /><br /> michael@robotics:~$ dpkg -l | grep squee<br /> ii base-files 6.0squeeze2 Debian base system miscellaneous files<br /> ii dbus-x11 1.2.24-4+squeeze1 simple interprocess messaging system (X11 deps)<br /> ii dhcp3-client 4.1.1-P1-15+squeeze2 ISC DHCP server (transitional package)<br /> ii isc-dhcp-client 4.1.1-P1-15+squeeze2 ISC DHCP client<br /> ii isc-dhcp-common 4.1.1-P1-15+squeeze2 common files used by all the isc-dhcp* packages<br /> ii libdbus-1-3 1.2.24-4+squeeze1 simple interprocess messaging system<br /> ii libgssapi-krb5-2 1.8.3+dfsg-4squeeze1 MIT Kerberos runtime libraries - krb5 GSS-API Mechanism<br /> ii libk5crypto3 1.8.3+dfsg-4squeeze1 MIT Kerberos runtime libraries - Crypto Library<br /> ii libkrb5-3 1.8.3+dfsg-4squeeze1 MIT Kerberos runtime libraries<br /> ii libkrb53 1.8.3+dfsg-4squeeze1 transitional package for MIT Kerberos libraries<br /> ii libkrb5support0 1.8.3+dfsg-4squeeze1 MIT Kerberos runtime libraries - Support library<br /> ii libssl0.9.8 0.9.8o-4squeeze1 SSL shared libraries<br /> ii libxml2 2.7.8.dfsg-2+squeeze1 GNOME XML library<br /> ii lsb-base 3.2-23.2squeeze1 Linux Standard Base 3.2 init script functionality<br /> ii openssl 0.9.8o-4squeeze1 Secure Socket Layer (SSL) binary and related cryptographic tools<br /> ii passwd 1:4.1.4.2+svn3283-2+squeeze1 change and administer password and group data<br /> ii tzdata 2011d-0squeeze1 time zone and daylight-saving time data<br /><br />Austin took a shot at fixing all of this on Nov 28, 2011. Here are his notes.<br />Austin: Ok, I think I have it all working again...<br /> Sent at 7:51 PM on Monday<br /> Austin: I don't really have much in the way of notes, other than that the package versions were off. I fixed this by using dpkg -l | grep squeeze to find the bad packages, and then apt-get install packagename/oldstable to downgrade it. I then fought long and hard.<br />I'm going to go to bed, but if you would like me to detail a bit more what I did, I can.<br /> Sent at 7:54 PM on Monday<br /> me: Thanks. Your notes are good enough. No need to spend more time on them.<br />Thank you for sorting things out on robotics.mvla.net. I appreciate it.<br /> Sent at 9:07 PM on Monday<br /> <br /># /media/usb0/svn-local-bin/README Describes the scripts<br /># Use the backupScripts.csh to backup all the scripts and configuration files that<br /># Michael has changed and remembered to include in the script.<br />#<br />ls -l /media/usb0/svn-local-bin<br /> -rwxr-xr-x 1 root root 1331 2011-12-03 15:54 backupNowToLocalDisk.csh<br /> -rwxr-xr-x 1 root root 4358 2011-12-03 16:59 backupOnlyChangedArchives.csh<br /> -rwxr-xr-x 1 root root 4674 2011-12-03 17:40 backupOnlyChangedArchivesDaily.csh<br /> -rwxr-xr-x 1 root root 4063 2011-12-03 17:51 backupOnlyChangedArchivesWeekly.csh<br /> -rwxr-xr-x 1 root root 1219 2011-12-03 21:15 backupScripts.csh<br /> -rwxr-xr-x 1 root root 21 2011-11-26 20:18 csh_check<br /> drwxr-xr-x 2 root root 4096 2011-12-03 20:48 RCS<br /> -rw-r--r-- 1 root root 593 2011-12-03 21:16 README<br /><br />/home/michael/backupSchuhComputers.rb<br /> Use this to backup the machine.<br /><br /><br />#=======================================<br />#<br /># The USB drive was being mounted with noexec at boot time. This prevents<br /># us from running scripts from it. This does not work well. The fstab<br /># entry was also being ignored. Austin suggested removing "hal". I did so<br /># on 12/26/11. Michael<br /># <br /># from "fstab -l"<br /># /dev/sdc1 on /media/usb0 type ext3 (rw,noexec,nodev,sync,noatime)<br /># <br />#<br />robotics:/# dpkg -l | grep hal<br />ii hal 0.5.11-8 Hardware Abstraction Layer<br />ii hal-info 20091130-1 Hardware Abstraction Layer - fdi files<br />ii libhal-storage1 0.5.11-8 Hardware Abstraction Layer - shared library <br />ii libhal1 0.5.14-3 Hardware Abstraction Layer - shared library<br />robotics:/# dpkg --purge hal hal-info libhal-storage1 libhal1<br /><br /><br /># It turns out that this did not fix the problem.<br /># <br /># The USB hard disk kept showing up with "noexec" at boot time. It took<br /># a while to figure out that usbmount was being called by udev and mounting it.<br /># We would much rather mount it by using the fstab entry than udev/usbmount.<br /># <br /># To turn of usbmount, I moved /etc/udev/rules.d/z60_usbmount.rules to noLongerUsed.rules.d<br /><br />robotics:/etc/udev# l noLongerUsed.rules.d/<br />total 0<br />lrwxrwxrwx 1 root root 17 2010-04-06 03:55 z60_usbmount.rules -&gt; ../usbmount.rules<br /><br /># This fixed the mounting incorrectly problem. Had to leave the "mount -a" in /etc/rc.local <br /># script.<br />#<br /># Michael</pre><h2>System Log</h2><p><strong style="font-size: 13.008px; line-height: 1.538em;">11/21/2015 Set up CAD machines to use different route to internet</strong></p><p style="padding-left: 30px;"><strong> </strong>The power to the MVHS campus was turned off 11/21/15 until 7 am.  When it came back up, the network would not let machines on the student network out of the campus.  Jack told me how to configure the network on the machines on the student network so that they would work on the internet.</p><p style="padding-left: 30px;">To get out of the MVHS Robotics classroom when the student network does not work,</p><p style="padding-left: 30px;">On a machine on the student network, use</p><p style="padding-left: 30px;">IP 172.20.21.x (Get this by seeing what the machine was assigned by the switch)<br />Subnet mask: 255.255.0.0<br />Default gateway 172.20.252.254<br />DNS Server 172.20.253.6 (He also said that we could use 8.8.8.8 - Google)</p><p style="padding-left: 30px;">Robotics.mvla.net has an internal address of 172.20.252.61 and the external address is 205.167.46.61</p><p><strong>10/1/2015 IP Address for printer in Ly's room</strong></p><p style="padding-left: 30px;"><strong> </strong>Todd gave me an IP address for the printer in Ly's room.  He told me: "Yes, I have been in touch with Jack.  You can try the address 172.20.196.8 by pinging it to see if it’s free.  If not just go up by one digit to see if the next one is available.  Let me know if you have problems.  I have about 4 more of those printer available if you need extras."<strong><br /></strong></p><p><strong>7/5/2015 Added fail2ban<br /><br />5/27/2015 Added NTP daemon to keep the time correct<br /><br />2/7/2014  Changed the IP address of the machine</strong></p><p style="padding-left: 30px;">Jack requested that we change the IP address.  So now the eth0 network is connected to the school network with 172.20.252.61 default route 172.20.252.254 and netmask of 255.255.0.0.  External to the school, the name is robotics.mvla.net with address: 205.167.46.61.  Jack set it up so we can ping the machine, send email to it, ssh to it, and use http and https.  Michael</p><p><strong>1/12/2014   Setup gitweb for Brian</strong></p><p style="padding-left: 30px;">Dave Smith and Michael set up gitweb so the 971 svn users can view the 971 git repositories.  While we were at it, we used an environment variable to specify team specific /etc/gitweb{114,971}.conf files for the teams in /etc/apache2/sites-available/robotics.</p><ul><li><span style="line-height: 1.538em;">apt-get install gitweb</span></li><li><span style="line-height: 1.538em;">Added customizations to /etc/apache2/sites-available/robotics</span></li><li><span style="line-height: 1.538em;">Made custom /etc/gitweb{114,971}.conf files from /etc/gitweb.conf.  Had them point to "/var/cache/git{114,971}".</span></li><li><span style="line-height: 1.538em;">Link in user git repositories into /var/cache/git{114,971}</span><ul><li><span style="line-height: 1.538em;">mkdir /var/cache/git971</span></li><li><span style="line-height: 1.538em;">cd /var/cache/git971</span></li><li><span style="line-height: 1.538em;">ln -s /www/https/git/frc971/brian/2013.git brian_2013.git  # do for each git repository.</span></li></ul></li><li><span style="line-height: 1.538em;">Replaced symbolic links in the user git repositories for object to have absolute paths</span><ul><li><span style="line-height: 1.538em;">ln -s /www/https/git/frc971/objects/2013</span><span style="line-height: 1.538em;"> /www/https/git/frc971/brian/2013.git/</span><span style="line-height: 1.538em;">objects</span></li></ul></li><li>Wrote /etc/apache2/make_git.passwd to create /etc/apache2/git{114,971}.passwd files using the team groups in /var/svn-repos/authz and the passwords from /etc/apache2/dav_svn.passwd.</li></ul><p><strong style="line-height: 1.538em;">4/13/2012  Does not connect to the network after MVHS power failure.</strong></p><p style="padding-left: 30px;">The server does not connect to the network after a power failure.  "ping goole.com" fails.  It appears that the routing table is messed up.  "ip route" does not show the 192.168.10.1 default route.  After reading this page, I ran "<code># route add default gw 192.168.10.1 eth0</code>" and "ping google.com" and everything else worked. </p><p style="padding-left: 30px;">I rebooted the machine with the network cable unplugged, plugged it in, and could not ping Google.  I did an "ifconfig eth0 down" and then an "ifconfig eth0 up" and "ip route" came back with the 192.168.10.1 default route missing.  I ran the "route add default gw 192.168.10.1 eth0" command again and everything worked again.</p><p style="padding-left: 30px;">robotics:~# route<br />Kernel IP routing table<br />Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br />192.168.1.0     *               255.255.255.0   U     0      0        0 eth1<br />192.168.10.0    *               255.255.255.0   U     0      0        0 eth0<br />default         192.168.10.1    0.0.0.0         UG    0      0        0 eth0</p><p><strong>1/7/2012  SVN repository error</strong></p><p style="padding-left: 30px;">frc971_bad_20120107_michael had a problem with a file in revision 2603 2006/trunk/pictures/2006_03_17. When doing an update on this, an error message was generated and the apache2 error.log file said there was a checksum problem.<br /><br />svnadmin verify /media/usb0/svn-repos/frc971 # This said there was a Checksum mismatch on version 2603. <br />cd /media/usb0/backups/svn/robotics.mvla.net.daily <br />tar -xvf frc971-2527.tar.bz2 # This took about an hour. The unzip was painfully slow. <br />svnadmin load frc971-2527 &lt; frc971_2528-2594.WeeklyIncr.dump <br />svnadmin load frc971-2527 &lt; frc971_2595-2611.DailyIncr.dump # I checked this version and it worked so I loaded the rest of the updates below. <br />mv frc971-2527 ../svn-repos/frc971recovered <br />cd ../svn-repos <br />cat frc971/db/current # Shows the current revision of the active repository. <br />svnadmin load frc971recovered &lt; ../backups/svn/robotics.mvla.net.daily/frc971_2612-2614.DailyIncr.dump <br />svnadmin load frc971recovered &lt; ../backups/svn/robotics.mvla.net.daily/frc971_2615-2617.DailyIncr.dump <br />svnadmin load frc971recovered &lt; ../backups/svn/robotics.mvla.net.daily/frc971_2618-2621.DailyIncr.dump <br />svnadmin load frc971recovered &lt; ../backups/svn/robotics.mvla.net.daily/frc971_2622-2625.DailyIncr.dump <br />svnadmin load frc971recovered &lt; ../backups/svn/robotics.mvla.net.daily/frc971_2626-2626.DailyIncr.dump <br />diff -r frc971 frc971recovered <br />diff -r frc971/conf/set_passwords.csh frc971recovered/conf/set_passwords.csh <br />cp frc971/conf/set_passwords.csh frc971recovered/conf/set_passwords.csh <br />chown -R www-data.subversion frc971recovered/ <br />mv frc971 frc971_bad_20120107_michael <br />mv frc971recovered frc971 <br /><br />robotics:/tmp/2006_03_17# svn up <br />svn: REPORT of '/svn/frc971/!svn/vcc/default': Could not read chunk delimiter: Secure connection truncated (https://robotics.mvla.net) <br /><br />robotics:/tmp/2006_03_17# svn info <br />Path: . <br />URL: https://robotics.mvla.net/svn/frc971/2006/trunk/pictures/2006_03_17 <br />Repository Root: https://robotics.mvla.net/svn/frc971 <br />Repository UUID: f308d9b7-e957-4cde-b6ac-9a88185e7312 <br />Revision: 2626 <br />Node Kind: directory <br />Schedule: normal <br /><br />robotics:/var/log/apache2# tail error.log <br />[Sat Jan 07 19:47:22 2012] [error] [client 192.168.10.61] Provider encountered an error while streaming a REPORT response. [500, #0] <br />[Sat Jan 07 19:47:22 2012] [error] [client 192.168.10.61] A failure occurred while driving the update report editor [500, #160004] <br />[Sat Jan 07 19:47:22 2012] [error] [client 192.168.10.61] Checksum mismatch while reading representation:\n expected: 54ded6bf34052dfe01cd67b50229d175\n actual: <br />f2d117f27f971408f37b3c6bb028ea33\n [500, #160004]</p><p><strong>12/8/2011 - Fixed network problems.</strong></p><p style="padding-left: 30px;">Jack,<br /><br />Thank you very much for the help today.  I told my 22 year old son, Austin, what you found with me on the server and he agreed that the second gateway was wrong.  He also noticed that I had it configured to use the nameserver at our house in addition to the MVHS nameserver and this was causing "ping <a href="http://google.com/" target="_blank" rel="noopener">google.com</a>" to be slow.  He fixed both of these.  He updated the /etc/network/interfaces file and rebooting to make sure the machine will come up with a proper configuration.  Here is what we have now:<br /><br /></p><div style="margin-left: 40px;"><span style="color: #ff0000;"># Used by ifup(8) and ifdown(8). See the interfaces(5) manpage or</span><br style="color: #ff0000;" /><span style="color: #ff0000;"># /usr/share/doc/ifupdown/examples for more information.</span><br style="color: #ff0000;" /><span style="color: #ff0000;">auto lo</span><br style="color: #ff0000;" /><span style="color: #ff0000;">iface lo inet loopback</span><br style="color: #ff0000;" /><br style="color: #ff0000;" /><span style="color: #ff0000;"># eth0 is the top ethernet plug on the server</span><br style="color: #ff0000;" /><span style="color: #ff0000;"># eth1 is the bottom ethernet plug on the server</span><br style="color: #ff0000;" /><br style="color: #ff0000;" /><span style="color: #ff0000;"># <span class="il">192.168</span>.10.61 is the MVLA internal IP address for <a href="http://robotics.mvla.net/" target="_blank" rel="noopener">robotics.mvla.net</a></span><br style="color: #ff0000;" /><span style="color: #ff0000;">auto eth0</span><br style="color: #ff0000;" /><span style="color: #ff0000;">iface eth0 inet static</span><br style="color: #ff0000;" /><span style="color: #ff0000;">     address <span class="il">192.168</span>.10.61</span><br style="color: #ff0000;" /><span style="color: #ff0000;">     network <span class="il">192.168</span>.10.0</span><br style="color: #ff0000;" /><span style="color: #ff0000;">     netmask 255.255.255.0</span><br style="color: #ff0000;" /><span style="color: #ff0000;">     gateway <span class="il">192.168</span>.<span class="il">10.1</span></span><br style="color: #ff0000;" /><span style="color: #ff0000;">     dns-nameservers 205.167.47.141</span><br style="color: #ff0000;" /><br style="color: #ff0000;" /><span style="color: #ff0000;">auto eth1</span><br style="color: #ff0000;" /><span style="color: #ff0000;">iface eth1 inet static</span><br style="color: #ff0000;" /><span style="color: #ff0000;">     address <span class="il">192.168</span>.1.67</span><br style="color: #ff0000;" /><span style="color: #ff0000;">     network <span class="il">192.168</span>.1.0</span><br style="color: #ff0000;" /><span style="color: #ff0000;">     netmask 255.255.255.0</span></div><p style="padding-left: 30px;">Here are three different ways of looking at the routing for the server:</p><div style="margin-left: 40px;">robotics:~# ip route<br /><span style="color: #ff0000;"><a href="http://192.168.1.0/24" target="_blank" rel="noopener"><span class="il">192.168</span>.1.0/24</a> dev eth1  proto kernel  scope link  src <span class="il">192.168</span>.1.67 </span><br style="color: #ff0000;" /><span style="color: #ff0000;"><a href="http://192.168.10.0/24" target="_blank" rel="noopener"><span class="il">192.168</span>.10.0/24</a> dev eth0  proto kernel  scope link  src <span class="il">192.168</span>.10.61 </span><br style="color: #ff0000;" /><span style="color: #ff0000;">default via <span class="il">192.168</span>.<span class="il">10.1</span> dev eth0 </span><br /><br />robotics:~# route<br /><span style="color: #ff0000;">Kernel IP routing table</span><br style="color: #ff0000;" /><span style="color: #ff0000;">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br style="color: #ff0000;" /><span style="color: #ff0000;"><span class="il">192.168</span>.1.0     *               255.255.255.0   U     0      0        0 eth1</span><br style="color: #ff0000;" /><span style="color: #ff0000;"><span class="il">192.168</span>.10.0    *               255.255.255.0   U     0      0        0 eth0</span><br style="color: #ff0000;" /><span style="color: #ff0000;">default         <span class="il">192.168</span>.<span class="il">10.1</span>    0.0.0.0         UG    0      0        0 eth0</span><br /><br />robotics:~# route -n<br /><span style="color: #ff0000;">Kernel IP routing table</span><br style="color: #ff0000;" /><span style="color: #ff0000;">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br style="color: #ff0000;" /><span style="color: #ff0000;"><span class="il">192.168</span>.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth1</span><br style="color: #ff0000;" /><span style="color: #ff0000;"><span class="il">192.168</span>.10.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0</span><br style="color: #ff0000;" /><span style="color: #ff0000;">0.0.0.0         <span class="il">192.168</span>.<span class="il">10.1</span>    0.0.0.0         UG    0      0        0 eth0</span></div><p style="padding-left: 30px;">It sure looks to me like the machine is working properly.  It is much more responsive to connection requests.<br /><br />Thank you again for your expert assistance.  I really appreciate it.<br /><br />Regards,<br />   Michael </p><p style="padding-left: 30px;"> </p><p>End of System Log</p></div></div></div>  </div>

  
  
</div>
  </div>
</div>
  </div>
    </div>